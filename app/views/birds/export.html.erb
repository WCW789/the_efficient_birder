<h1>Birding List</h1>

<div id="birds">
  <% Bird.all.each do |bird| %>
    <div id="<%= dom_id bird %>">

    <% image_urls = {} %>

    <%# <% image_urls[bird.id] = bird.image.map { |img| main_app.rails_blob_url(img) } %>
    <%# <% image_urls[bird.id] = bird.image.map { |img| rails_blob_url(img) } %>
    <%# <% puts "test #{image_urls}" %>

    <% if bird.image.attached? %>

      <div id="dataContainer"></div>
      <%# <%= image_tag wicked_pdf_asset_base64(image_url) %>
        <%# <% @image_urls[bird.id].each do |image_url| %> %>
          <%# <%= image_tag wicked_pdf_asset_base64(image_url) %>
        <%# <% end %>

      <%# <% @image_urls = JSON.parse("http://127.0.0.1:3000/birds/json_pdf") %>
        <%# <% puts "test #{@image_urls}" %>
        <%# <% image_urls[bird.id].each do |image_url| %>
          <%# <%= image_tag wicked_pdf_asset_base64(image_url) %>
        <%# <% end %>

    <p>
      <strong>Name:</strong>
      <%= bird.name %>
    </p>

    <p>
      <strong>Datetime:</strong>
      <%= bird.datetime %>
    </p>

    <p>
      <strong>Latitude:</strong>
      <%= bird.latitude %>
    </p>

    <p>
      <strong>Longitude:</strong>
      <%= bird.longitude %>
    </p>

    <p>
      <strong>Notes:</strong>
      <%= bird.notes %>
    </p>

    <% end %>

    </div>
  <% end %>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function() {
    fetch('/birds/pdf_json')
      .then(response => response.json())
      .then(data => {
        const dataContainer = document.getElementById('dataContainer');
        console.log("data", data)

        data.forEach(item => {
          const listItem = document.createElement('li');
          listItem.textContent = item.name;
          dataContainer.appendChild(listItem);
          console.log("item", item)
        });
      })
      .catch(error => console.error('Error fetching JSON:', error));
  });
</script>
